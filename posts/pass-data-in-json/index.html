<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to pass data in JSON format in config map to the microservice | Wei's Home</title><meta name=keywords content><meta name=description content="When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values."><meta name=author content="Wei"><link rel=canonical href=http://weiguo98.github.io/posts/pass-data-in-json/><link crossorigin=anonymous href=/assets/css/stylesheet.7140587df96a2b1a49eb723fa7063dc0c641a6cb638f3140e8d3beb4deae4f5c.css integrity="sha256-cUBYfflqKxpJ63I/pwY9wMZBpstjjzFA6NO+tN6uT1w=" rel="preload stylesheet" as=style><link rel=icon href=http://weiguo98.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://weiguo98.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://weiguo98.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://weiguo98.github.io/apple-touch-icon.png><link rel=mask-icon href=http://weiguo98.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="How to pass data in JSON format in config map to the microservice"><meta property="og:description" content="When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values."><meta property="og:type" content="article"><meta property="og:url" content="http://weiguo98.github.io/posts/pass-data-in-json/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-25T22:10:18+01:00"><meta property="article:modified_time" content="2023-05-25T22:10:18+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to pass data in JSON format in config map to the microservice"><meta name=twitter:description content="When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"http://weiguo98.github.io/posts/"},{"@type":"ListItem","position":3,"name":"How to pass data in JSON format in config map to the microservice","item":"http://weiguo98.github.io/posts/pass-data-in-json/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to pass data in JSON format in config map to the microservice","name":"How to pass data in JSON format in config map to the microservice","description":"When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values.","keywords":[],"articleBody":" When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values. Here are the exact steps to pass data through config map: Set up a config map with json format data apiVersion: \"v1\" kind: \"ConfigMap\" metadata: name: json-configmap data: config.json: | { \"key1\": \"value1\", \"key2\": \"value2\" } Create a volume in the pod and mount it to the container we want. apiVersion: \"apps/v1\" kind: \"Deployment\" metadata: name: \"test-service\" spec: template: metadata: volumes: - name: \"json-config-volume\" configMap: // make sure the name equals to the name in configmap metadata.name name: \"json-configmap\" containers: - name: \"container-first\" volumeMounts: - name: \"config-volume\" mountPath: \"/etc/config\" // not necessary, you can hardcoded in the code base, put it here just make sure // if anyday we changed the mountpath, make sure change the env as well. env: - name: \"CONFIG_FILE\" value: \"/etc/config/config.json\" In the code base, we can through os.getEnv() get easy access to the JSON file and do the un-marshal to it. // Based on the json format type JsonConfig struct{ key1 string key2 string } func getJsonConfig() error{ filePath, ok := os.LookupEnv(\"CONFIG_FILE\") if !ok { return errors.New(\"failed to get file path\") } config, err := os.Open(filePath) if err != nil { return errors.Wrap(err, \"failed to open file\") } defer config.Close() byteValue, err := io.ReadAll(config) if err != nil { return errors.Wrap(err, \"failed to read file\") } jsonConfig := \u0026JsonConfig{} if err = json.Unmarshal(byteValue, jsonConfig); err != nil { return errors.Wrap(err, \"failed to unmarshal file\") } return nil } ","wordCount":"328","inLanguage":"en","datePublished":"2023-05-25T22:10:18+01:00","dateModified":"2023-05-25T22:10:18+01:00","author":{"@type":"Person","name":"Wei"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://weiguo98.github.io/posts/pass-data-in-json/"},"publisher":{"@type":"Organization","name":"Wei's Home","logo":{"@type":"ImageObject","url":"http://weiguo98.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://weiguo98.github.io accesskey=h title="Wei's Home (Alt + H)">Wei's Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://weiguo98.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=http://weiguo98.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://weiguo98.github.io>Home</a>&nbsp;»&nbsp;<a href=http://weiguo98.github.io/posts/>Posts</a></div><h1 class=post-title>How to pass data in JSON format in config map to the microservice</h1><div class=post-meta><span title='2023-05-25 22:10:18 +0100 +0100'>May 25, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Wei</div></header><div class=post-content><ul><li>When we have little data need to pass from helm chart to service, it quit easy to use the <code>container.env</code> part in the <code>deployment.yaml</code>. So that we could just <code>os.getEnv()</code> in the code, we got the value we want.</li><li>But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values.</li><li>Here are the exact steps to pass data through config map:<ul><li><ol><li>Set up a config map with json format data</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: &#34;v1&#34;
</span></span><span class=line><span class=cl>kind: &#34;ConfigMap&#34;
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: json-configmap
</span></span><span class=line><span class=cl>data:
</span></span><span class=line><span class=cl>  config.json: |
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>    	&#34;key1&#34;: &#34;value1&#34;,
</span></span><span class=line><span class=cl>      	&#34;key2&#34;: &#34;value2&#34;
</span></span><span class=line><span class=cl>    }
</span></span></code></pre></div></li><li><ol start=2><li>Create a volume in the pod and mount it to the container we want.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>apiVersion: &#34;apps/v1&#34;
</span></span><span class=line><span class=cl>kind: &#34;Deployment&#34;
</span></span><span class=line><span class=cl>metadata:
</span></span><span class=line><span class=cl>  name: &#34;test-service&#34;
</span></span><span class=line><span class=cl>spec:
</span></span><span class=line><span class=cl>	template:
</span></span><span class=line><span class=cl>    	metadata:
</span></span><span class=line><span class=cl>          volumes:
</span></span><span class=line><span class=cl>              - name: &#34;json-config-volume&#34;
</span></span><span class=line><span class=cl>                configMap:
</span></span><span class=line><span class=cl>                  // make sure the name equals to the name in configmap metadata.name
</span></span><span class=line><span class=cl>                  name: &#34;json-configmap&#34;
</span></span><span class=line><span class=cl>        containers:
</span></span><span class=line><span class=cl>        - name: &#34;container-first&#34;
</span></span><span class=line><span class=cl>          volumeMounts:
</span></span><span class=line><span class=cl>          	- name: &#34;config-volume&#34;
</span></span><span class=line><span class=cl>              mountPath: &#34;/etc/config&#34;
</span></span><span class=line><span class=cl>          // not necessary, you can hardcoded in the code base, put it here just make sure
</span></span><span class=line><span class=cl>          // if anyday we changed the mountpath, make sure change the env as well.
</span></span><span class=line><span class=cl>          env:
</span></span><span class=line><span class=cl>          	- name: &#34;CONFIG_FILE&#34;
</span></span><span class=line><span class=cl>              value: &#34;/etc/config/config.json&#34;
</span></span></code></pre></div></li></ul></li><li><ol start=3><li>In the code base, we can through <code>os.getEnv()</code> get easy access to the JSON file and do the un-marshal to it.</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// Based on the json format
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>JsonConfig</span> <span class=kd>struct</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>key1</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>  <span class=nx>key2</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>getJsonConfig</span><span class=p>()</span> <span class=kt>error</span><span class=p>{</span>
</span></span><span class=line><span class=cl>  	<span class=nx>filePath</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>LookupEnv</span><span class=p>(</span><span class=s>&#34;CONFIG_FILE&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;failed to get file path&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>config</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=nx>filePath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to open file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>config</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>byteValue</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>io</span><span class=p>.</span><span class=nf>ReadAll</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to read file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>  	<span class=nx>jsonConfig</span> <span class=o>:=</span>  <span class=o>&amp;</span><span class=nx>JsonConfig</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>byteValue</span><span class=p>,</span> <span class=nx>jsonConfig</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to unmarshal file&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=http://weiguo98.github.io/posts/my-first-post/><span class=title>Next »</span><br><span>Kubernetes probes and pod lifecycle</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=http://weiguo98.github.io>Wei's Home</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>