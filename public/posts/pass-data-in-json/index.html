<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>How to pass data in JSON format in config map to the microservice | Wei's Home</title><meta name=keywords content><meta name=description content="When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values."><meta name=author content="Wei"><link rel=canonical href=http://weiguo98.github.io/posts/pass-data-in-json/><link crossorigin=anonymous href=/assets/css/stylesheet.2af4e238783dd6516e7a376ec8aa77e7e3a2f6214d9bb3f8d69a116e557b3af0.css integrity="sha256-KvTiOHg91lFuejduyKp35+Oi9iFNm7P41poRblV7OvA=" rel="preload stylesheet" as=style><link rel=icon href=http://weiguo98.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://weiguo98.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://weiguo98.github.io/favicon-32x32.png><link rel=apple-touch-icon href=http://weiguo98.github.io/apple-touch-icon.png><link rel=mask-icon href=http://weiguo98.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://weiguo98.github.io/posts/pass-data-in-json/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme: rgb(29, 30, 32);--entry: rgb(46, 46, 51);--primary: rgb(218, 218, 219);--secondary: rgb(155, 156, 157);--tertiary: rgb(65, 66, 68);--content: rgb(196, 196, 197);--hljs-bg: rgb(46, 46, 51);--code-bg: rgb(55, 56, 62);--border: rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-123-45','auto');ga('send','pageview');}</script><meta property="og:title" content="How to pass data in JSON format in config map to the microservice"><meta property="og:description" content="When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values."><meta property="og:type" content="article"><meta property="og:url" content="http://weiguo98.github.io/posts/pass-data-in-json/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-05-25T22:10:18+01:00"><meta property="article:modified_time" content="2023-05-25T22:10:18+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="How to pass data in JSON format in config map to the microservice"><meta name=twitter:description content="When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":3,"name":"How to pass data in JSON format in config map to the microservice","item":"http://weiguo98.github.io/posts/pass-data-in-json/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"How to pass data in JSON format in config map to the microservice","name":"How to pass data in JSON format in config map to the microservice","description":"When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values.","keywords":[],"articleBody":" When we have little data need to pass from helm chart to service, it quit easy to use the container.env part in the deployment.yaml. So that we could just os.getEnv() in the code, we got the value we want. But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values. Here are the exact steps to pass data through config map:    Set up a config map with json format data  apiVersion: \"v1\" kind: \"ConfigMap\" metadata: name: json-configmap data: config.json: | { \"key1\": \"value1\", \"key2\": \"value2\" }   Create a volume in the pod and mount it to the container we want.  apiVersion: \"apps/v1\" kind: \"Deployment\" metadata: name: \"test-service\" spec: template: metadata: volumes: - name: \"json-config-volume\" configMap: // make sure the name equals to the name in configmap metadata.name name: \"json-configmap\" containers: - name: \"container-first\" volumeMounts: - name: \"config-volume\" mountPath: \"/etc/config\" // not necessary, you can hardcoded in the code base, put it here just make sure // if anyday we changed the mountpath, make sure change the env as well. env: - name: \"CONFIG_FILE\" value: \"/etc/config/config.json\"     In the code base, we can through os.getEnv() get easy access to the JSON file and do the un-marshal to it.  // Based on the json format type JsonConfig struct{ key1 string key2 string } func getJsonConfig() error{ filePath, ok := os.LookupEnv(\"CONFIG_FILE\") if !ok { return errors.New(\"failed to get file path\") } config, err := os.Open(filePath) if err != nil { return errors.Wrap(err, \"failed to open file\") } defer config.Close() byteValue, err := io.ReadAll(config) if err != nil { return errors.Wrap(err, \"failed to read file\") } jsonConfig := \u0026JsonConfig{} if err = json.Unmarshal(byteValue, jsonConfig); err != nil { return errors.Wrap(err, \"failed to unmarshal file\") } return nil }   ","wordCount":"328","inLanguage":"en","datePublished":"2023-05-25T22:10:18+01:00","dateModified":"2023-05-25T22:10:18+01:00","author":{"@type":"Person","name":"Wei"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://weiguo98.github.io/posts/pass-data-in-json/"},"publisher":{"@type":"Organization","name":"Wei's Home","logo":{"@type":"ImageObject","url":"http://weiguo98.github.io/favicon.ico"}}}</script></head><body id=top><script>if(localStorage.getItem("pref-theme")==="dark"){document.body.classList.add('dark');}else if(localStorage.getItem("pref-theme")==="light"){document.body.classList.remove('dark')}else if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');}</script><header class=header><nav class=nav><div class=logo><a href=http://weiguo98.github.io accesskey=h title="Wei's Home (Alt + H)">Wei's Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=http://weiguo98.github.io/fr/ title=Profile aria-label=Profile>Profile</a></li></ul></div></div><ul id=menu><li><a href=http://weiguo98.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=http://weiguo98.github.io/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://weiguo98.github.io>Home</a></div><h1 class=post-title>How to pass data in JSON format in config map to the microservice</h1><div class=post-meta><span title="2023-05-25 22:10:18 +0100 +0100">May 25, 2023</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Wei</div></header><div class=post-content><ul><li>When we have little data need to pass from helm chart to service, it quit easy to use the <code>container.env</code> part in the <code>deployment.yaml</code>. So that we could just <code>os.getEnv()</code> in the code, we got the value we want.</li><li>But what if we have a lot of values to pass, it is a mess to add them all in the helm chart. Then, we could use config map here. Personally, I prefer to use the JSON format, because it is easy to un-marshal to struct, and we can get easy access to all the values.</li><li>Here are the exact steps to pass data through config map:<ul><li><ol><li>Set up a config map with json format data</li></ol><pre><code class=language-helm data-lang=helm>apiVersion: &quot;v1&quot;
kind: &quot;ConfigMap&quot;
metadata:
  name: json-configmap
data:
  config.json: |
    {
      &quot;key1&quot;: &quot;value1&quot;,
          &quot;key2&quot;: &quot;value2&quot;
    }
</code></pre></li><li><ol start=2><li>Create a volume in the pod and mount it to the container we want.</li></ol><pre><code class=language-helm data-lang=helm>apiVersion: &quot;apps/v1&quot;
kind: &quot;Deployment&quot;
metadata:
  name: &quot;test-service&quot;
spec:
  template:
      metadata:
          volumes:
              - name: &quot;json-config-volume&quot;
                configMap:
                  // make sure the name equals to the name in configmap metadata.name
                  name: &quot;json-configmap&quot;
        containers:
        - name: &quot;container-first&quot;
          volumeMounts:
              - name: &quot;config-volume&quot;
              mountPath: &quot;/etc/config&quot;
          // not necessary, you can hardcoded in the code base, put it here just make sure
          // if anyday we changed the mountpath, make sure change the env as well.
          env:
              - name: &quot;CONFIG_FILE&quot;
              value: &quot;/etc/config/config.json&quot;

</code></pre></li></ul></li><li><ol start=3><li>In the code base, we can through <code>os.getEnv()</code> get easy access to the JSON file and do the un-marshal to it.</li></ol><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=c1>// Based on the json format
</span><span class=c1></span><span class=kd>type</span> <span class=nx>JsonConfig</span> <span class=kd>struct</span><span class=p>{</span>
  <span class=nx>key1</span> <span class=kt>string</span>
  <span class=nx>key2</span> <span class=kt>string</span>
<span class=p>}</span>


<span class=kd>func</span> <span class=nf>getJsonConfig</span><span class=p>()</span> <span class=kt>error</span><span class=p>{</span>
      <span class=nx>filePath</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>LookupEnv</span><span class=p>(</span><span class=s>&#34;CONFIG_FILE&#34;</span><span class=p>)</span>
  <span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;failed to get file path&#34;</span><span class=p>)</span>
  <span class=p>}</span>

  <span class=nx>config</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>Open</span><span class=p>(</span><span class=nx>filePath</span><span class=p>)</span>
  <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to open file&#34;</span><span class=p>)</span>
  <span class=p>}</span>
  <span class=k>defer</span> <span class=nx>config</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>

  <span class=nx>byteValue</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>io</span><span class=p>.</span><span class=nf>ReadAll</span><span class=p>(</span><span class=nx>config</span><span class=p>)</span>
  <span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to read file&#34;</span><span class=p>)</span>
  <span class=p>}</span>
      <span class=nx>jsonConfig</span> <span class=o>:=</span>  <span class=o>&amp;</span><span class=nx>JsonConfig</span><span class=p>{}</span>
  <span class=k>if</span> <span class=nx>err</span> <span class=p>=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Unmarshal</span><span class=p>(</span><span class=nx>byteValue</span><span class=p>,</span> <span class=nx>jsonConfig</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
      <span class=k>return</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>Wrap</span><span class=p>(</span><span class=nx>err</span><span class=p>,</span> <span class=s>&#34;failed to unmarshal file&#34;</span><span class=p>)</span>
  <span class=p>}</span>
  <span class=k>return</span> <span class=kc>nil</span>
<span class=p>}</span>
</code></pre></div></li></ul></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=http://weiguo98.github.io/posts/my-first-post/><span class=title>Next »</span><br><span>Kubernetes probes and pod lifecycle</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=http://weiguo98.github.io>Wei's Home</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z" /></svg></a><script>let menu=document.getElementById('menu')
if(menu){menu.scrollLeft=localStorage.getItem("menu-scroll-position");menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft);}}
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{anchor.addEventListener("click",function(e){e.preventDefault();var id=this.getAttribute("href").substr(1);if(!window.matchMedia('(prefers-reduced-motion: reduce)').matches){document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({behavior:"smooth"});}else{document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();}
if(id==="top"){history.replaceState(null,null," ");}else{history.pushState(null,null,`#${id}`);}});});</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){if(document.body.scrollTop>800||document.documentElement.scrollTop>800){mybutton.style.visibility="visible";mybutton.style.opacity="1";}else{mybutton.style.visibility="hidden";mybutton.style.opacity="0";}};</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{if(document.body.className.includes("dark")){document.body.classList.remove('dark');localStorage.setItem("pref-theme",'light');}else{document.body.classList.add('dark');localStorage.setItem("pref-theme",'dark');}})</script><script>document.querySelectorAll('pre > code').forEach((codeblock)=>{const container=codeblock.parentNode.parentNode;const copybutton=document.createElement('button');copybutton.classList.add('copy-code');copybutton.innerHTML='copy';function copyingDone(){copybutton.innerHTML='copied!';setTimeout(()=>{copybutton.innerHTML='copy';},2000);}
copybutton.addEventListener('click',(cb)=>{if('clipboard'in navigator){navigator.clipboard.writeText(codeblock.textContent);copyingDone();return;}
const range=document.createRange();range.selectNodeContents(codeblock);const selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);try{document.execCommand('copy');copyingDone();}catch(e){};selection.removeRange(range);});if(container.classList.contains("highlight")){container.appendChild(copybutton);}else if(container.parentNode.firstChild==container){}else if(codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"){codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);}else{codeblock.parentNode.appendChild(copybutton);}});</script></body></html>